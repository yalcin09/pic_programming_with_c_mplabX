/*
 * File:   ADC app
 * 
 * ----------------------------------------------------------
 * |                    ADCON0 REGISTER                     |
 * ----------------------------------------------------------
 * |ADCS1 |ADCS1 | CHS2 | CHs1 | CHS0 |GO/DONE|   -  | ADON |
 * ----------------------------------------------------------
 * | Bit7 | Bit6 | Bit5 | Bit4 | Bit3 |  Bit2 | Bit1 | Bit0 |
 * ----------------------------------------------------------
 * 
 *  ADCS1-ADCS0 : ADD i?lemi için saat seçme bitidir. ADCS2 biti ADCON1
 * saklay?c?s?ndad?r.
 *  
 * ---------------------------------------------------------------
 * | ADCS2 | ADCS1 | ADCS0 | Saat Durumu                         |
 * ---------------------------------------------------------------
 * |   0   |   0   |   0   | FOSC/2                              |
 * ---------------------------------------------------------------
 * |   0   |   0   |   1   | FOSC/8                              |
 * ---------------------------------------------------------------
 * |   0   |   1   |   0   | FOSC/32                             |
 * ---------------------------------------------------------------
 * |   0   |   1   |   1   | FOSC Dahili ADD RC OS üretilen saat |
 * ---------------------------------------------------------------
 * |   1   |   0   |   0   | FOSC/4                              |
 * ---------------------------------------------------------------
 * |   1   |   0   |   1   | FOSC/16                             |
 * ---------------------------------------------------------------
 * |   1   |   1   |   0   | FOSC/64                             |
 * ---------------------------------------------------------------
 * |   1   |   1   |   1   | FOSC Dahili ADD RC OS üretilen saat |
 * ---------------------------------------------------------------
 * 
 *  CHS2 - CHS0: Analog kanal seçme biti.
 *  ------------------------------------------
 *  | CHS2 | CHS1 | CHS0 | Kanal Seçme | PIN |
 *  ------------------------------------------
 *  |   0  |   0  |   0  |     AN0     | RA0 |
 *  ------------------------------------------
 *  |   0  |   0  |   1  |     AN1     | RA1 |
 *  ------------------------------------------
 *  |   0  |   1  |   0  |     AN2     | RA2 |
 *  ------------------------------------------
 *  |   0  |   1  |   1  |     AN3     | RA3 |
 *  ------------------------------------------
 *  |   1  |   0  |   0  |     AN4     | RA5 |
 *  ------------------------------------------
 *  |   1  |   0  |   1  |     AN5     | RE0 |
 *  ------------------------------------------
 *  |   1  |   1  |   0  |     AN6     | RE1 |
 *  ------------------------------------------
 *  |   1  |   1  |   1  |     AN7     | RE2 |
 *  ------------------------------------------
 * 
 * GO/DONE: ADD i?lemi ba?latma biti
 * ADON: ADD modu açma kapatma biti
 *       ADON: 1 ise ADD aç?k
 *       ADON: 0 ise ADD kapal?
 * 
 * 
 * ---------------------------------------------------------
 * |                    ADCON1 REGISTER                    |
 * ---------------------------------------------------------
 * | ADFM |ADCS2 |   -  |   -  |PCFG3 |PCFG2 |PCFG1 |PCFG0 |
 * ---------------------------------------------------------
 * | Bit7 | Bit6 | Bit5 | Bit4 | Bit3 | Bit2 | Bit1 | Bit0 |
 * ---------------------------------------------------------
 * 
 *  ADFM: ADD i?lemi sonuç seçme biti.
 *  0:
 *  --------------------------------------
 *  |ADRESH SAKLAYICI |ADRESL SAKLAYICISI|
 *  --------------------------------------
 *  |X|X|X|X|X|X|X|X| |X|X|0|0|0|0|0|0   |
 *  --------------------------------------
 *  |9|8|7|6|5|4|3|2| |1|0|-|-|-|-|-|-   |
 *  --------------------------------------
 * 
 *  1:
 *  --------------------------------------
 *  |ADRESH SAKLAYICI |ADRESL SAKLAYICISI|
 *  --------------------------------------
 *  |0|0|0|0|0|0|X|X| |X|X|X|X|X|X|X|X   |
 *  --------------------------------------
 *  |-|-|-|-|-|-|9|8| |7|6|5|4|3|2|1|0   |
 *  --------------------------------------
 * 
 *  ADCS2 : PIC16F77A bulunur, PIC16F77'de bulunmaz.
 *  PCFG3-PCFG0:
 * 
 */


#include "LCD_LIB.h"

#define ORAN 5.0/1024.0

void main(void) {
    
    // ADC SET
    TRISA       = 0x01;
    ADCON0      = 0x01;         // Fosc/2 ve AN0(RA0)) seçildi.
    ADCON1      = 0x80;         // ADMF = 1 ve Bütün analog pinler aktif
    
    //LCD
    TRISD       = 0x00;
    
    lcd_prepare();
    
    while(1){
        
        GO_DONE = 1;                      // Analog okuma ba?la.
        while(GO_DONE);
        double tmp = (ADRESH*256 + ADRESL) * ORAN * 100;
        int volt = (int)tmp;
        lcd_gotoxy(1,1);
        send_data((volt%1000)/100+48);   // Yüzler basama??
        send_data('.');
        send_data((volt%100)/10+48);     // Onlar basama??
        send_data((volt%10)+48);         // Birler basama??
        send_data('V');
        
    }
    return;
}
